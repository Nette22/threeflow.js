<!doctype html>

<html>
  <head>
    <title>example</title>
    <script src="/socket.io/socket.io.js"></script>
    <script src="js/vendor/three.js"></script>
    <script src="js/vendor/dat.gui.js"></script>
    <script src="js/vendor/TrackballControls.js"></script>
    <script src="js/threeflow.js"></script>
    <script src="js/scene_basic.js"></script>
    <script>
      var initialise = function()
      {
        var scene = SceneBasic();
        var sunflowRenderer = new THREE.SunflowRenderer();
        sunflowRenderer.connect();

        var renderer = new THREE.WebGLRenderer({antialias:true});
        var width = 600;
        var height = 400;
        renderer.setSize(width,height);
        document.body.appendChild(renderer.domElement);

        var camera = new THREE.PerspectiveCamera(35,width/height,1,10000);
        console.log("Aspect",width/height);
        camera.position.set(0,0,500);
        camera.lookAt( new THREE.Vector3(0,0,0) );
        scene.add(camera);

        var hemLight = new THREE.HemisphereLight(0xeeeeff,0xefefef,1);
        scene.add(hemLight);

        var light = new THREE.PointLight(0xffffff,100,400);
        //scene.add(light);
        light.position.x = light.position.y = light.position.z = 200;

        var ambient = new THREE.AmbientLight(0x555555);
        //scene.add(ambient);

        var plane = new THREE.Mesh( new THREE.PlaneGeometry(1000000,1000000,5,5), new THREE.MeshLambertMaterial({color:0xffffff,ambient:0xffffff,side:THREE.DoubleSide}) );
        plane.rotation.x = Math.PI/2;
        plane.position.y = -20;
        scene.add(plane);


        var controls = new THREE.TrackballControls(camera,renderer.domElement);

        var render = function()
        {
            requestAnimationFrame(render);
            controls.update();
            renderer.render(scene,camera);
        }

        var onRenderClick = function( event ){
            event.preventDefault();
            sunflowRenderer.render(scene,camera,width,height);
        }

        document.getElementById("renderButton").addEventListener( "click", onRenderClick );

        render();
      }

    </script>
  </head>
  <body onload="initialise();">
    <button id="renderButton" style="position:absolute;z-index:100;">Render</button>
  </body>
</html>