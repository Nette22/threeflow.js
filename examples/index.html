<!doctype html>

<html>
  <head>
    <title>example</title>
    <script src="/socket.io/socket.io.js"></script>
    <script src="js/vendor/three.js"></script>
    <script src="js/vendor/dat.gui.js"></script>
    <script src="js/vendor/TrackballControls.js"></script>
    <script src="js/threeflow.js"></script>
    <script>
      var initialise = function()
      {
        var scenes          = createScenes();
        var currentScene    = null;

        var sunflowRenderer = new THREE.SunflowRenderer();
        sunflowRenderer.connect();

        var renderer = new THREE.WebGLRenderer({antialias:true});
        renderer.setSize(window.innerWidth,window.innerHeight);
        document.body.appendChild(renderer.domElement);

        var camera = new THREE.PerspectiveCamera(35,window.innerWidth/window.innerHeight,1,10000);
        camera.position.set(0,500,500);
        camera.lookAt( new THREE.Vector3(0,0,0) );

        var controls = new THREE.TrackballControls(camera,renderer.domElement);

        var render = function()
        {
            requestAnimationFrame(render);
            controls.update();
            renderer.render(currentScene,camera);
        }

        var setScene = function(index)
        {
            currentScene = scenes[index];
            currentScene.add(camera);
        }

        var onRenderClick = function( event ){
            event.preventDefault();
            sunflowRenderer.render(currentScene,camera,window.innerWidth,window.innerHeight);
        }

        document.getElementById("renderButton").addEventListener( "click", onRenderClick );

        setScene(0);
        render();
      }


      var createScenes = function()
      {
        var scenes = [];

        var scene = new THREE.Scene();
        var ix,iz;
        var size = 5;
        var radius = 50;
        var spacing = radius*3;

        // Material Spheres Scene.
        var material = new THREE.MeshLambertMaterial({color:0x112299,ambient:0xffffff,side:THREE.DoubleSide,shading:THREE.FlatShading});
        var geom = new THREE.PlaneGeometry(size*spacing*2,size*spacing*2);
        var mesh = new THREE.Mesh(geom,material);
        mesh.rotation.x = Math.PI/2;
        mesh.position.y = -radius;
        scene.add(mesh);

        //var ambient = new THREE.AmbientLight(0x333333);
        //scene.add(ambient);
        var light = new THREE.PointLight(0xffffff, 1, 10000);
        light.position.set(500,500,500);
        scene.add(light);

        geom = new THREE.SphereGeometry(radius);

        for( ix = 0; ix<size;ix++)
        {
            for(iz = 0; iz<size; iz++){
                material = new THREE.MeshLambertMaterial( {color:0xaa9900,ambient:0x000000,shading:THREE.FlatShading} );
                mesh = new THREE.Mesh( geom, material );
                mesh.position.x = ( ix*spacing ) - ((spacing*(size-1))/2);
                mesh.position.z = ( iz*spacing ) - ((spacing*(size-1))/2);
                scene.add( mesh );
            }
        }
        scenes.push(scene);

        return scenes;
      }

    </script>
  </head>
  <body onload="initialise();">
    <button id="renderButton" style="position:absolute;z-index:100;">Render</button>
  </body>
</html>